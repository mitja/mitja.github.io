{{- $url := .Get "url" | default "" -}}
{{- $title := .Get "title" | default "Embedded App" -}}
{{- $height := .Get "height" | default "600px" -}}
{{- $responsive := .Get "responsive" | default "false" -}}

{{- if $url -}}
  {{- $fullUrl := $url -}}
  {{- if not (hasPrefix $url "http") -}}
    {{- $fullUrl = printf "https://%s" $url -}}
  {{- end -}}

  <div style="margin: 25px 0;">
    {{/* Header with title and open link */}}
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        background-color: var(--accent);
        border-radius: var(--radius) var(--radius) 0 0;
      "
    >
      <h3 style="margin: 0; font-size: 1.1em; color: var(--background);">
        {{ $title }}
      </h3>
      <a
        href="{{ $fullUrl }}"
        target="_blank"
        rel="noopener noreferrer"
        style="
          padding: 6px 12px;
          background-color: var(--background);
          color: var(--accent);
          text-decoration: none;
          border-radius: var(--radius);
          font-size: 0.9em;
          font-weight: bold;
          white-space: nowrap;
        "
      >
        Open in new tab â†—
      </a>
    </div>

    {{- if eq $responsive "true" -}}
    {{/* Responsive container with 16:9 aspect ratio */}}
    <div
      style="
        position: relative;
        padding-bottom: 56.25%;
        height: 0;
        overflow: hidden;
        border: 8px solid var(--accent);
        border-top: none;
        border-radius: 0 0 var(--radius) var(--radius);
        background-color: var(--background);
      "
    >
      <iframe
        style="
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          border: 0;
        "
        src="{{ $fullUrl }}"
        title="{{ $title }}"
        frameborder="0"
        loading="lazy"
      ></iframe>
    </div>
    {{- else -}}
    {{/* Fixed height container */}}
    <div
      style="
        width: 100%;
        height: {{ $height }};
        border: 8px solid var(--accent);
        border-top: none;
        border-radius: 0 0 var(--radius) var(--radius);
        background-color: var(--background);
        overflow: hidden;
      "
    >
      <iframe
        style="
          width: 100%;
          height: 100%;
          border: 0;
        "
        src="{{ $fullUrl }}"
        title="{{ $title }}"
        frameborder="0"
        loading="lazy"
      ></iframe>
    </div>
    {{- end -}}
  </div>
{{- else -}}
  {{ errorf "iframed shortcode requires a 'url' parameter. The issue occurred in %q" .Page.File }}
{{- end -}}
